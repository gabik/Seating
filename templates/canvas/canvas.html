<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
<script type="text/javascript" src="http://www.labs.skengdon.com/border/js/border.min.js"></script>


<script type="text/javascript">
var SelectedElem = "" ;

$(document).ready(function() {
  var imgs,i;
  imgs=document.getElementsByTagName('img');
  for(i=0;i<imgs.length;i++)
  {
    if (imgs[i].id.split("-", 1) == "long_square") {
      document.getElementById(imgs[i].id).src = "http://www1.free-clipart.net/gallery2/clipart/Household/Miscellaneous/Table_Setting_1.jpg";
    } else if (imgs[i].id.split("-", 1) == "round_pink") {
      document.getElementById(imgs[i].id).src = "http://photos1.fotosearch.com/bthumb/UNC/UNC002/u13738840.jpg";
    }
  }
  $(".DragDiv").click( function() {
    if (SelectedElem != "" ) { 
      SelectedElem.border('0px white 0');
    }
    $(this).border('2px pink .5');
    SelectedElem = $(this);
  });
  $(".DragDiv").draggable({ 
     start: function (e,ui){
       $(this).fadeTo(200, 0.3);
       $("#SaveStatImg").attr("src", "http://careers.physicstoday.org/pics/icons/gma_red_50/js_saved_jobs.gif");
     },
     stop: function (e,ui){
       $(this).fadeTo(200, 1.0);
       $.post('/canvas/save/', {elem_num: $(this).context.id, X: $(this).position().left , Y: $(this).position().top },
         function(data){
           if (data.status == 'OK')
           {
             $("#SaveStatImg").attr("src", "http://maemo.nokia.com/userguides/.img/CONNECTIVITY-WLAN-SAVED.jpg");
           }else{
             $("#SaveStatImg").attr("src", "http://www.arco.co.uk/103/images/icons/error.gif");
           }
         }, 'json');
     }
  });
  $(".DelDiv").click( function() {
    if (SelectedElem != "" ) {
      $("#SaveStatImg").attr("src", "http://careers.physicstoday.org/pics/icons/gma_red_50/js_saved_jobs.gif");
      $.post('/canvas/delete/', {elem_num: SelectedElem.context.id}, 
        function(data){
          if (data.status == 'OK')
          { location.reload(); }
        }, 'json');
    } else {
      alert ("Please select table");
    }
  });
  $(".AddDiv").click( function() {
    $('ul.AddMenu').slideToggle('medium');
  });
  $(".MenuItem").click( function() {
    $('ul.AddMenu').hide('medium');
    $.post('/canvas/add/', {kind: $(this).context.id}, 
      function(data){
        if (data.status == 'OK')
        { location.reload(); }
      }, 'json');
  });
  $(document).keypress(function(e) {
    $(".DelDiv").click();
  });

  $(document).click( function(e) {
    if (!($(e.target).hasClass('ElemImg'))) {
      if (SelectedElem != "" ) { 
        SelectedElem.border('0px white 0');
        SelectedElem = "";
      }
    }
  });
});
</script>


<link rel="stylesheet" type="text/css" href="/templates/canvas/canvas.css" />
<script type="text/javascript">
 window.onload = function()
 {
  var DivId = [];
  var DDiv = [];
  {% for elem in elements %}
   DivId[{{ elem.elem_num }}] = "DragDiv-{{ elem.elem_num }}";
   DDiv[{{ elem.elem_num }}] = document.getElementById(DivId[{{ elem.elem_num }}]);
   DDiv[{{ elem.elem_num }}].style.left = {{ elem.x_cord }} + "px";
   DDiv[{{ elem.elem_num }}].style.top = {{ elem.y_cord }} + "px";
   DDiv[{{ elem.elem_num }}].onmousedown = function()
   {
    Dragging = true;
   } 
  {% endfor %}
 }
 
</script>
<title>Simple Drag</title>
</head>

<body>

	<DIV id="main">
		<div id="canvas-div">
			{% for div in elements %}
    			<div class="DragDiv" id="DragDiv-{{ div.elem_num }}"><img src="http://cdn4.iconfinder.com/data/icons/sphericalcons/128/waiting.png" class="ElemImg" id="{{ div.kind }}-{{ div.elem_num }}"></div>
			{% endfor %}
			<div class="AddDiv"><img src="http://icons.iconseeker.com/png/fullsize/boomy/add-2.png"></div>
 			<ul class="AddMenu">
 				<li><a href="#"><img id="round_pink" border=0 src="http://photos1.fotosearch.com/bthumb/UNC/UNC002/u13738840.jpg" class="MenuItem"></a></li>
 				<li><a href="#"><img id="long_square" border=0 src="http://www1.free-clipart.net/gallery2/clipart/Household/Miscellaneous/Table_Setting_1.jpg" class="MenuItem"></a></li>
 			</ul>
			<div class="DelDiv"><img src="http://icons.iconseeker.com/png/fullsize/web-application/delete-9.png"></div>
			<div class="SaveStat">Save Status:<img id="SaveStatImg" src="http://maemo.nokia.com/userguides/.img/CONNECTIVITY-WLAN-SAVED.jpg"></div>

		</div>
		<div id="right-bar">
			<div id="people-list">
				<select id="people_list" name="people-list" multiple="multiple">
					{% for guest in guests %}
						<option>  {{ guest.floatingguest_first_name }} {{ guest.floatingguest_last_name }} </option>
					{% endfor %}
				</select>
			</div>
		</div>
	</DIV>

</body>
</html>

